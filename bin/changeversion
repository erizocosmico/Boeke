#!/usr/bin/env python
# -*- coding: utf-8 -*-

from __future__ import print_function, with_statement
import sys
import os

if len(sys.argv) < 2:
    print('changeversion <version>')
    os.exit(2)
    
version = sys.argv[1]
PATH = os.path.dirname(os.path.dirname(os.path.realpath(__file__)))

for root, dirs, files in os.walk(PATH):
    path = root.split('/')
    print((len(path) - 1) * '--' , os.path.basename(root))
    
    if 'vendor' in dirs:
        dirs.remove('vendor')
    if '.git' in dirs:
        dirs.remove('.git')
        
    for file in files:
        if file.endswith('.php'):
            with open('/'.join(path) + '/' + file, 'r') as f:
                lines = f.readlines()
                lines[8] = ' * @version     ' + version + '\n'
    
            with open('/'.join(path) + '/' + file, 'w') as f:
                f.writelines(lines)
            print(len(path) * '---', file)
